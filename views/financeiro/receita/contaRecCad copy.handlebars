<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<title>contas a receber</title>
		<script type="text/javascript">
		
			function atualizaDadosbene(){
				let beneid = document.getElementById("contarecBeneid").value;
				
				document.getElementById("contarecBenenome").value = document.getElementById(beneid+"_beneNome").value;
				document.getElementById("contarecTomador").value = document.getElementById(beneid+"_beneOrdemnome").value;
				document.getElementById("contarecCpfcnpj").value = document.getElementById(beneid+"_beneOrdemdoc").value;
				document.getElementById("contarecRetencao").value = document.getElementById(beneid+"_beneOrdemretem").value;
				document.getElementById("contarecConvid").value = document.getElementById(beneid+"_beneConvid").value;
				
				let convid = document.getElementById("contarecConvid").value;
				console.log(convid);
				document.getElementById("contarecConvnomeTemp").value = document.getElementById(convid+"_beneConvnome").value;

			}

			function atualizaCheckbox(checkbox) {
				// Obtém o valor do checkbox (true ou false)
				let valcheck;

				if (checkbox.checked !== undefined) {
					valcheck = checkbox.checked;
				} else {
					// Caso a propriedade "checked" não esteja disponível, tenta obter o estado usando o atributo "value"
					valcheck = checkbox.value === "true";
				}

				// Constrói o nome do campo temporário
				const checkboxTempName = checkbox.name + "temp";

				// Obtém a referência ao campo temporário
				const tempField = document.getElementsByName(checkboxTempName)[0];

				// Verifica se o campo temporário foi encontrado antes de atribuir o valor
				if (tempField) {
					tempField.value = valcheck;
					console.log('Valor: ' + valcheck);
				} else {
					console.error('Campo temporário não encontrado para ' + checkboxTempName);
				}
			}
			

			function formatarNumeroBrasileiro(valor) {
				return parseFloat(valor.replace(',', '.')).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
			}

			function formatarCampoNumerico(elementId) {
				let elemento = document.getElementById(elementId);
				let valor = elemento.value;

				// Remove caracteres não numéricos, exceto ponto e vírgula
				valor = valor.replace(/[^\d.,]/g, '');

				// Substitui vírgulas por pontos para garantir a correta conversão para número
				valor = valor.replace(',', '.');

				// Converte para número
				let numero = parseFloat(valor);

				// Verifica se é um número válido
				if (!isNaN(numero)) {
					// Formata o número no estilo brasileiro
					let numeroFormatado = formatarNumeroBrasileiro(numero.toFixed(2));
					elemento.value = numeroFormatado;
				} else {
					// Se não for um número válido, limpa o campo
					elemento.value = '';
				}
			}

			function calculaImpostoPIS() {
				let valorNf = document.getElementById("contarecVlrnf").value.replace('.', '').replace(',', '.');
				let checkpis = document.getElementById("checkboxPistemp").value;
				let alqpis = document.getElementById("contarecAlqpis").value.replace('%', '').replace(',', '.');
				console.log(document.getElementById("contarecVlrnf").value);
				console.log(valorNf);
				console.log(alqpis);
				if (!isNaN(valorNf) && valorNf >= 0.01 && !(checkpis === "false" || alqpis <= 0.001 || alqpis === null || checkpis === "")) {
					let resultado = (valorNf * (alqpis/100)).toFixed(2);
					document.getElementById("contarecVlrpis").value = parseFloat(resultado).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
				} else {
					document.getElementById("contarecVlrpis").value = "0,00";
				}
			}

			function calculaImpostoCSSL() {
				let valorNf = document.getElementById("contarecVlrnf").value.replace('.', '').replace(',', '.');
				let checkcssl = document.getElementById("checkboxCssltemp").value;
				let alqcssl = document.getElementById("contarecAlqcssl").value.replace('%', '').replace(',', '.');
				console.log(valorNf);
				console.log(alqcssl);
				if (!isNaN(valorNf) && valorNf >= 0.01 && !(checkcssl === "false" || alqcssl <= 0.001 || alqcssl === null || checkcssl === "")) {
					let resultado = (valorNf * (alqcssl/100)).toFixed(2);
					document.getElementById("contarecVlrcssl").value = parseFloat(resultado).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
				} else {
					document.getElementById("contarecVlrcssl").value = "0,00";
				}
			}

			function calculaImpostoCOFINS() {
				let valorNf = document.getElementById("contarecVlrnf").value.replace('.', '').replace(',', '.');
				let checkcofins = document.getElementById("checkboxCofinstemp").value;
				let alqcofins = document.getElementById("contarecAlqcofins").value.replace('%', '').replace(',', '.');
				console.log(valorNf);
				console.log(alqcofins);
				if (!isNaN(valorNf) && valorNf >= 0.01 && !(checkcofins === "false" || alqcofins <= 0.001 || alqcofins === null || checkcofins === "")) {
					let resultado = (valorNf * (alqcofins/100)).toFixed(2);
					document.getElementById("contarecVlrcofins").value = parseFloat(resultado).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
				} else {
					document.getElementById("contarecVlrcofins").value = "0,00";
				}
			}

			function calculaImpostoISS() {
				let valorNf = document.getElementById("contarecVlrnf").value.replace('.', '').replace(',', '.');
				let checkiss = document.getElementById("checkboxIsstemp").value;
				let alqiss = document.getElementById("contarecAlqiss").value.replace('%', '').replace(',', '.');
				console.log(valorNf);
				console.log(alqiss);
				if (!isNaN(valorNf) && valorNf >= 0.01 && !(checkiss === "false" || alqiss <= 0.001 || alqiss === null || checkiss === "")) {
					let resultado = (valorNf * (alqiss/100)).toFixed(2);
					document.getElementById("contarecVlriss").value = parseFloat(resultado).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
				} else {
					document.getElementById("contarecVlriss").value = "0,00";
				}
			}
			
			function calculaImpostoIRPJ() {
				let valorNf = document.getElementById("contarecVlrnf").value.replace('.', '').replace(',', '.');
				let checkirpj = document.getElementById("checkboxIrpjtemp").value;
				let alqirpj = document.getElementById("contarecAlqirpj").value.replace('%', '').replace(',', '.');
				console.log(valorNf);
				console.log(alqirpj);
				if (!isNaN(valorNf) && valorNf >= 0.01 && !(checkirpj === "false" || alqirpj <= 0.001 || alqirpj === null || checkirpj === "")) {
					let resultado = (valorNf * (alqirpj/100)).toFixed(2);

					// Formata o resultado para o formato brasileiro
					document.getElementById("contarecVlrirpj").value = parseFloat(resultado).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
				} else {
					document.getElementById("contarecVlrirpj").value = "0,00";
				}
			}

			
			
		</script>
	</head>
	
	<body onload="javascript:controlaNave();" class="no-skin">
		<div class="main-container ace-save-state" id="main-container">
			<div class="main-content">
				<div class="main-content-inner">
					<div class="breadcrumbs ace-save-state" id="breadcrumbs">
						<ul class="breadcrumb">
							<li>
								<i class="ace-icon fa fa-home home-icon"></i>
								<a href="#">Home</a>
							</li>
							<li class="active">Contas à receber - Cadastro</li>
						</ul><!-- /.breadcrumb -->
					</div>
					<div id="divCarrega" name="divCarrega" class="hidden">
						<!-- /.importante Id de indice-->
						<!-- /.IMPORTANTE!!! TODOS type DEVEM SER text !!!!!!!!!!!-->
						{{#each benes}}
							<input type="text" id="{{_id}}_beneNome" name="beneNomeEdi" value="{{bene_nome}}"/>
							<input type="text" id="{{_id}}_beneOrdemnome" name="beneOrdemnomeEdi" value="{{bene_ordemnome}}"/>
							<input type="text" id="{{_id}}_beneOrdemdoc" name="beneOrdemdocEdi" value="{{bene_ordemdoc}}"/>
							<input type="text" id="{{_id}}_beneOrdemretem" name="beneOrdemretemEdi" value="{{bene_ordemretem}}"/>
							<input type="text" id="{{_id}}_beneConvid" name="beneConvidEdi" value="{{bene_convid}}"/>
						{{/each}}
						{{#each convs}}
							<input type="text" id="{{_id}}_beneConvnome" name="{{bene_convid}}_convNomeEdi" value="{{conv_nome}}"/>
						{{/each}}
						{{#each convimps}}
							<input type="text" id="{{_id}}_convId" name="{{conv_beneid}}_convBeneidEdix" value="{{bene_convid}}"/>
						{{/each}}
						

					</div>
					<div class="row">
						<div class="col-xs-12">
							<!-- PAGE CONTENT BEGINS -->
							<form class="form-horizontal" role="form" action="/menu/financeiro/receita/add" method="POST">
								<div class="col-sm-12"><!-- Widget Dados Básicos -->
									<div class="widget-box">
										<div class="widget-header">
											<h4 class="widget-title">Dados</h4>
											<span class="widget-toolbar">
												<a href="#" data-action="reload">
													<i class="ace-icon fa fa-refresh"></i>
												</a>
												<a href="#" data-action="collapse">
													<i class="ace-icon fa fa-chevron-up"></i>
												</a>
											</span>
										</div>
										<div class="widget-body">
											<div class="widget-main">
												<div hidden>
													<!-- Registro de Operadores -->
													<label> Usuário Cadastro</label>
													<div class="form-group">
														<div class="col-sm-3">
															<input type="text" name="contarecUsuidcad" id="contarecUsuidcad" placeholder="" value="{{usuarioAtual}}" />
														</div>
													</div>
													<label> Data Cadastro</label>
													<div class="form-group">
														<div class="col-sm-3">
															<input name="contarecDatacad" id="contarecDatacad" placeholder=""  value="{{dataAtual}}"/>
														</div>
													</div>
													<label> Usuário Editou</label>
													<div class="form-group">
														<div class="col-sm-3">
															<input type="text" name="contarecUsuidedi" id="contarecUsuidedi" placeholder=""  />
														</div>
													</div>
													<label> Data Edição</label>
													<div class="form-group">
														<div class="col-sm-3">
															<input type="date" name="contarecDataedi" id="contarecDataedi" placeholder="" />
														</div>
													</div>
												</div>
												<!-- Identificador da NF -->
												<label for="id-date-picker-1">Data Emissão da Nota Fiscal</label>
												<div class="form-group">
													<div class="col-sm-4">
														<input id="contarecDataevento" name="contarecDataevento" type="date">
													</div>
												</div>
												<label>Ano/Mês Referência</label>
												<div class="form-group">
													<div class="col-sm-1">
														<input type="text" name="contarecAnomesatend" id="contarecAnomesatend" placeholder=""  />
													</div>
												</div>
												<label> Número da Nota Fiscal</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecNfnum" id="contarecNfnum" placeholder=""  />
													</div>
												</div>
												
												<label>Beneficiário</label>
												<div class="form-group" >
													<div class="col-xs-9 col-sm-9">
														<select class="col-xs-9 col-sm-9" name="contarecBeneid" id="contarecBeneid" class="chosen-select" data-placeholder="Escolha..."  onchange="javascript:atualizaDadosbene();">
															<option value="766f69643132333435366964">-</option>
															{{#each benes}}
																<option value="{{_id}}">{{bene_nome}}</option>
															{{/each}}
														</select>
													</div>
												</div>
												<label> Convênio</label>
												<div class="form-group">
													<div class="col-sm-12">
														<input type="text" name="contarecConvid" id="contarecConvid" placeholder="" hidden />
														<input type="text" name="contarecConvnomeTemp" id="contarecConvnomeTemp" placeholder="" style="width: 20%;" />
														
													</div>
												</div>
												<label> Nome Do Beneficiário</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecBenenome" id="contarecBenenome" placeholder=""  />
													</div>
												</div>
												<label>Nome do Tomador do Serviço perante a prefeitura</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecTomador" id="contarecTomador" placeholder="" />
													</div>
												</div>
												<label>CPF/CNPJ do Tomador</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecCpfcnpj" id="contarecCpfcnpj" placeholder=""  />
													</div>
												</div>
												<label>Retenção</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecRetencao" id="contarecRetencao" placeholder="" />
													</div>
												</div>
												<!-- Informações da NF-->
												
											
												<label>Valor da Nota Fiscal</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecVlrnf" id="contarecVlrnf" placeholder="0,00" style="text-align: right; width:100px;" onchange="formatarCampoNumerico('contarecVlrnf');calculaImposto();"/>
													</div>
												</div>
												
												<label for="id-date-picker-1">Data Empréstimo</label>
												<div class="form-group">
													<div class="col-sm-4">
														<input id="contarecDataemprest" name="contarecDataemprest" type="date">
													</div>
												</div>
												<label for="id-date-picker-1">Data Devolução</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input id="contarecDataadevol" name="contarecDataadevol" type="date">
													</div>
												</div>
												
												<label for="id-date-picker-1">Data Previsão de Pagamento</label>
												<div class="form-group">
													<div class="col-sm-4">
														<input id="contarecDataprev" name="contarecDataprev" type="date">
													</div>
												</div>
												<label>Valor Pago</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecVlrpg" id="contarecVlrpg" placeholder="0,00" style="text-align: right; width:100px;" onchange="formatarCampoNumerico('contarecVlrpg');"/>
													</div>
												</div>
												<label>Valor Diferença</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecVlrdiferenca" id="contarecVlrdiferenca" placeholder="0,00" style="text-align: right;  width:100px;" onchange="formatarCampoNumerico('contarecVlrdiferenca');"/>
													</div>
												</div>
												<label>Forma de Pagamento</label>
												<div class="form-group">
													<div class="col-sm-3">
														<input type="text" name="contarecFormapg" id="contarecFormapg" placeholder=""  />
													</div>
												</div>
												<label for="id-date-picker-1">Data de Pagamento</label>
												<div class="form-group">
													<div class="col-sm-4">
														<input type="date" id="contarecDatapg" name="contarecDatapg"  placeholder="">
													</div>
												</div>
												<div class="col-12-sm">
													
														<table>
															<thead>
																<tr>
																	<th></th>
																	<th style="width: 70px;"><span>Imposto</span></th>
																	<th style="width: 80px; text-align: right;"><span>Alíquota</span></th>
																	<th></th>
																	<th style="text-align: right;"><span >Valor</span></th>
																</tr>
															</thead>
															<tbody>
																<tr>
																	<td class="center">
																		<label class="pos-rel">
																			<input type="checkbox" name="checkboxPis" name="checkboxPis" class="ace" id="checkboxPis" onchange="atualizaCheckbox(checkboxPis);calculaImpostoPIS();"/>
																			<span class="lbl"></span>
																			<input type="text" class="hidden" id="checkboxPistemp" name="checkboxPistemp" value="false" />
																		</label>
																	</td>
																	<td>PIS</td>
																	<td ><input type="text" name="contarecAlqpis" id="contarecAlqpis" style="text-align: right; width:80px;" value="0,65%" onchange="calculaImpostoPIS();"/></td>
																	<td style="width: 20px;"></td>
																	<td><input type="text" name="contarecVlrpis" id="contarecVlrpis" style="text-align: right; width:100px;" value="0,00"/></td>
																</tr>
																<tr>
																	<td class="center">
																		<label class="pos-rel">
																			<input type="checkbox" name="checkboxCssl" id="checkboxCssl" class="ace" onchange="atualizaCheckbox(checkboxCssl);calculaImpostoCSSL();" />
																			<span class="lbl"></span>
																			<input type="text" class="hidden" id="checkboxCssltemp" name="checkboxCssltemp" value="false" />
																		</label>
																	</td>
																	<td>CSSL</td>
																	<td><input type="text" name="contarecAlqcssl" id="contarecAlqcssl" style="text-align: right; width:80px;" value="1,0%" onchange="calculaImpostoCSSL();"/></td>
																	<td style="width: 20px;"></td>
																	<td><input type="text" name="contarecVlrcssl" id="contarecVlrcssl" style="text-align: right; width:100px;" value="0,00" /></td>
																</tr>
																<tr>
																	<td class="center">
																		<label class="pos-rel">
																			<input type="checkbox" name="checkboxCofins" id="checkboxCofins" class="ace" onchange="atualizaCheckbox(checkboxCofins);calculaImpostoCOFINS();" />
																			<span class="lbl"></span>
																			<input type="text" class="hidden" id="checkboxCofinstemp" name="checkboxCofinstemp" value="false" />
																		</label>
																	</td>
																	<td>COFINS</td>
																	<td><input type="text" name="contarecAlqcofins" id="contarecAlqcofins" style="text-align: right; width:80px;"  value="3,0%" onchange="calculaImpostoCOFINS();" /></td>
																	<td style="width: 20px;"></td>
																	<td><input type="text" name="contarecVlrcofins" id="contarecVlrcofins" style="text-align: right; width:100px;" value="0,00"/></td>
																</tr>
																<tr>
																	<td class="center">
																		<label class="pos-rel">
																			<input type="checkbox" name="checkboxIrpj" id="checkboxIrpj" class="ace" onchange="atualizaCheckbox(checkboxIrpj);calculaImpostoIRPJ();" />
																			<span class="lbl"></span>
																			<input type="text" class="hidden" id="checkboxIrpjtemp" name="checkboxIrpjtemp" value="false" />
																		</label>
																	</td>
																	<td>IRPJ</td>
																	<td><input type="text" name="contarecAlqirpj" id="contarecAlqirpj" style="text-align: right; width:80px;" value="1,5%" onchange="calculaImpostoIRPJ();"/></td>
																	<td style="width: 20px;"></td>
																	<td><input type="text" name="contarecVlrirpj" id="contarecVlrirpj" style="text-align: right; width:100px;" value="0,00" /></td>
																</tr>
																
																<tr>
																	<td class="center">
																		<label class="pos-rel">
																			<input type="checkbox" name="checkboxIss" id="checkboxIss" class="ace" onchange="atualizaCheckbox(checkboxIss);calculaImpostoISS();" />
																			<span class="lbl"></span>
																			<input type="text" class="hidden" id="checkboxIsstemp" name="checkboxIsstemp" value="false" />
																		</label>
																	</td>
																	<td>ISS</td>
																	<td><input type="text" name="contarecAlqiss" id="contarecAlqiss" style="text-align: right; width:80px"  value="5,0%" onchange="calculaImpostoISS();" /></td>
																	<td style="width: 20px;"></td>
																	<td><input type="text" name="contarecVlriss" id="contarecVlriss" style="text-align: right; width:100px" value="0,00"/></td>
																</tr>
												
												</tbody>
														</table>
													
												</div>
												<!-- Observações-->
												<label>Pago?</label>
												<div class="form-group">
													<div class="col-sm-3">
														<select name="contarecPg" id="contarecPg" class="chosen-select" data-placeholder="Escolha...">
															<option value="Não">Não</option>
															<option value="Sim">Sim</option>
														</select>
													</div>
												</div>
												<label>Descrição da Nota fiscal</label>
												<div class="form-group">
													<div class="col-sm-3">
														<textarea type="text" name="contarecDescr" id="contarecDescr" placeholder="" ></textarea>
													</div>
												</div>
												<label>Observações gerais sobre pagamentos etc</label>
												<div class="form-group">
													<div class="col-sm-3">
														<textarea type="text" name="contarecObs" id="contarecObs" placeholder="" ></textarea>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xs-12" style="text-align: center;" >
									<button class="btn btn-info"  name="acao" type="submit">
										<i class="ace-icon fa fa-check bigger-110"></i>
										Salvar
									</button>
									&nbsp; &nbsp; &nbsp;
									<button class="btn btn-warning"  onclick="/menu/financeiro/receita/lis">
										<i class="ace-icon fa fa-undo bigger-110"></i>
										Voltar
									</button>
								</div>
							</form>
						</div><!-- /.col -->
					</div><!-- /.row -->
				</div>
			</div><!-- /.main-content -->
		</div><!-- /.main-container --><!-- basic scripts -->
	</body>
</html>
